import React, { useState, useEffect } from 'react';

interface Step1Props {
  onComplete: (data: {
    writingStylePaths: string[]; // ë§íˆ¬ ë¬¸ì„œ íŒŒì¼ ê²½ë¡œë“¤
    seoGuidePath: string;        // SEO ê°€ì´ë“œ íŒŒì¼ ê²½ë¡œ
    topic: string;
    generatedContent?: string;   // ìƒì„±ëœ ê¸€ (ì˜µì…”ë„)
  }) => void;
}

interface SavedDocument {
  id: string;
  name: string;
  content: string;
  filePath: string;  // ì‹¤ì œ ì €ì¥ëœ íŒŒì¼ ê²½ë¡œ
  createdAt: string;
}

// ê³µìš© ë‹¤ì´ì–¼ë¡œê·¸ ì»´í¬ë„ŒíŠ¸
const ConfirmDialog: React.FC<{
  isOpen: boolean;
  title: string;
  message: string;
  onConfirm: () => void;
  onCancel: () => void;
}> = ({ isOpen, title, message, onConfirm, onCancel }) => {
  if (!isOpen) return null;

  return (
    <div style={{
      position: 'fixed',
      top: 0,
      left: 0,
      right: 0,
      bottom: 0,
      backgroundColor: 'rgba(0, 0, 0, 0.5)',
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      zIndex: 1000
    }}>
      <div style={{
        backgroundColor: '#fff',
        borderRadius: '12px',
        padding: '24px',
        maxWidth: '400px',
        width: '90%',
        boxShadow: '0 10px 25px rgba(0, 0, 0, 0.2)'
      }}>
        <h3 style={{ margin: '0 0 16px 0', color: '#495057', fontSize: '18px' }}>{title}</h3>
        <p style={{ margin: '0 0 24px 0', color: '#6c757d', fontSize: '14px', lineHeight: '1.5' }}>
          {message}
        </p>
        <div style={{ display: 'flex', gap: '12px', justifyContent: 'flex-end' }}>
          <button
            onClick={onCancel}
            style={{
              padding: '8px 16px',
              border: '1px solid #dee2e6',
              borderRadius: '6px',
              backgroundColor: '#f8f9fa',
              color: '#495057',
              cursor: 'pointer',
              fontSize: '14px'
            }}
          >
            ì·¨ì†Œ
          </button>
          <button
            onClick={onConfirm}
            style={{
              padding: '8px 16px',
              border: 'none',
              borderRadius: '6px',
              backgroundColor: '#dc3545',
              color: '#fff',
              cursor: 'pointer',
              fontSize: '14px'
            }}
          >
            ì‚­ì œ
          </button>
        </div>
      </div>
    </div>
  );
};

const Step1Setup: React.FC<Step1Props> = ({ onComplete }) => {
  
  // í‚¤ì›Œë“œ ì…ë ¥ ìƒíƒœ
  const [mainKeyword, setMainKeyword] = useState('');
  const [subKeywords, setSubKeywords] = useState('');
  const [blogContent, setBlogContent] = useState(''); // "ì–´ë–¤ ë¸”ë¡œê·¸ë¥¼ ì“°ê³  ì‹¶ì€ì§€" ì…ë ¥
  
  // ì œëª© ì¶”ì²œ ê´€ë ¨ ìƒíƒœ
  const [isGeneratingTitles, setIsGeneratingTitles] = useState(false);
  const [generatedTitles, setGeneratedTitles] = useState<string[]>([]);
  const [selectedTitle, setSelectedTitle] = useState('');
  
  // ìƒì„± ê´€ë ¨ ìƒíƒœ
  const [isGenerating, setIsGenerating] = useState(false);
  const [generationStep, setGenerationStep] = useState<string>('');
  
  // ì €ì¥ëœ ë¬¸ì„œë“¤
  const [savedWritingStyles, setSavedWritingStyles] = useState<SavedDocument[]>([]);
  const [savedSeoGuides, setSavedSeoGuides] = useState<SavedDocument[]>([]);
  
  // ì„ íƒëœ ë¬¸ì„œë“¤ (ë§íˆ¬ 2ê°œ, SEO 1ê°œ)
  const [selectedWritingStyles, setSelectedWritingStyles] = useState<SavedDocument[]>([]);
  const [selectedSeoGuide, setSelectedSeoGuide] = useState<SavedDocument | null>(null);

  // ë‹¤ì´ì–¼ë¡œê·¸ ìƒíƒœ
  const [deleteDialog, setDeleteDialog] = useState<{
    isOpen: boolean;
    docId: string;
    docName: string;
    type: 'writingStyle' | 'seoGuide';
  }>({
    isOpen: false,
    docId: '',
    docName: '',
    type: 'writingStyle'
  });

  // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì €ì¥ëœ ë¬¸ì„œë“¤ ë¡œë“œ
  useEffect(() => {
    const loadSavedDocuments = async () => {
      const savedWritingStylesData = localStorage.getItem('savedWritingStyles');
      
      if (savedWritingStylesData) {
        setSavedWritingStyles(JSON.parse(savedWritingStylesData));
      }
      
      // í•­ìƒ íŒŒì¼ì‹œìŠ¤í…œì—ì„œ ìµœì‹  SEO ê°€ì´ë“œ ë¡œë“œ (ê¸°ë³¸ ë¬¸ì„œ í¬í•¨)
      try {
        const seoGuides = await window.electronAPI.loadDocuments('seoGuide');
        if (seoGuides && seoGuides.length > 0) {
          setSavedSeoGuides(seoGuides);
          localStorage.setItem('savedSeoGuides', JSON.stringify(seoGuides));
          
          // ê¸°ë³¸ SEO ê°€ì´ë“œê°€ ìˆìœ¼ë©´ ìë™ ì„ íƒ
          const defaultSEO = seoGuides.find((doc: SavedDocument) => doc.name.includes('ê¸°ë³¸'));
          if (defaultSEO && !selectedSeoGuide) {
            setSelectedSeoGuide(defaultSEO);
          }
        } else {
          // SEO ê°€ì´ë“œê°€ í•˜ë‚˜ë„ ì—†ìœ¼ë©´ ê¸°ë³¸ ê°€ì´ë“œ ìƒì„±
          await window.electronAPI.createDefaultSEO();
          // ìƒì„± í›„ ë‹¤ì‹œ ë¡œë“œ
          const newSeoGuides = await window.electronAPI.loadDocuments('seoGuide');
          if (newSeoGuides && newSeoGuides.length > 0) {
            setSavedSeoGuides(newSeoGuides);
            localStorage.setItem('savedSeoGuides', JSON.stringify(newSeoGuides));
            
            const defaultSEO = newSeoGuides.find((doc: SavedDocument) => doc.name.includes('ê¸°ë³¸'));
            if (defaultSEO && !selectedSeoGuide) {
              setSelectedSeoGuide(defaultSEO);
            }
          }
        }
      } catch (error) {
        console.error('SEO ê°€ì´ë“œ ë¬¸ì„œ ë¡œë“œ ì‹¤íŒ¨:', error);
        // ì‹¤íŒ¨ ì‹œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œë¼ë„ ë¡œë“œ ì‹œë„
        const savedSeoGuidesData = localStorage.getItem('savedSeoGuides');
        if (savedSeoGuidesData) {
          const seoGuides = JSON.parse(savedSeoGuidesData);
          setSavedSeoGuides(seoGuides);
          
          const defaultSEO = seoGuides.find((doc: SavedDocument) => doc.name.includes('ê¸°ë³¸'));
          if (defaultSEO && !selectedSeoGuide) {
            setSelectedSeoGuide(defaultSEO);
          }
        }
      }
    };
    
    loadSavedDocuments();
  }, []);


  // ë§íˆ¬ ë¬¸ì„œ ì„ íƒ/í•´ì œ í•¨ìˆ˜
  const toggleWritingStyle = (doc: SavedDocument) => {
    const isSelected = selectedWritingStyles.some(selected => selected.id === doc.id);
    
    if (isSelected) {
      // ì„ íƒ í•´ì œ
      setSelectedWritingStyles(selectedWritingStyles.filter(selected => selected.id !== doc.id));
    } else {
      // ì„ íƒ (ìµœëŒ€ 2ê°œ)
      if (selectedWritingStyles.length < 2) {
        setSelectedWritingStyles([...selectedWritingStyles, doc]);
      } else {
        alert('ë§íˆ¬ ë¬¸ì„œëŠ” ìµœëŒ€ 2ê°œê¹Œì§€ë§Œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!');
      }
    }
  };

  // SEO ê°€ì´ë“œ ì„ íƒ í•¨ìˆ˜
  const toggleSeoGuide = (doc: SavedDocument) => {
    setSelectedSeoGuide(selectedSeoGuide?.id === doc.id ? null : doc);
  };

  // ì‚­ì œ ë‹¤ì´ì–¼ë¡œê·¸ ì—´ê¸°
  const openDeleteDialog = (type: 'writingStyle' | 'seoGuide', docId: string, docName: string) => {
    setDeleteDialog({
      isOpen: true,
      docId,
      docName,
      type
    });
  };

  // ë¬¸ì„œ ì‚­ì œ í™•ì¸
  const confirmDelete = async () => {
    const { type, docId } = deleteDialog;

    try {
      if (type === 'writingStyle') {
        // ë¬¼ë¦¬ íŒŒì¼ ì‚­ì œ
        const docToDelete = savedWritingStyles.find(doc => doc.id === docId);
        if (docToDelete) {
          await window.electronAPI.deleteDocument(docToDelete.filePath);
        }
        
        // ì„ íƒëœ ë¬¸ì„œì—ì„œë„ ì œê±°
        setSelectedWritingStyles(selectedWritingStyles.filter(doc => doc.id !== docId));
        const updated = savedWritingStyles.filter(doc => doc.id !== docId);
        setSavedWritingStyles(updated);
        localStorage.setItem('savedWritingStyles', JSON.stringify(updated));
      } else {
        // ë¬¼ë¦¬ íŒŒì¼ ì‚­ì œ
        const docToDelete = savedSeoGuides.find(doc => doc.id === docId);
        if (docToDelete) {
          await window.electronAPI.deleteDocument(docToDelete.filePath);
        }
        
        // ì„ íƒëœ SEO ê°€ì´ë“œë„ ì œê±°
        if (selectedSeoGuide?.id === docId) {
          setSelectedSeoGuide(null);
        }
        const updated = savedSeoGuides.filter(doc => doc.id !== docId);
        setSavedSeoGuides(updated);
        localStorage.setItem('savedSeoGuides', JSON.stringify(updated));
      }
    } catch (error) {
      console.error('íŒŒì¼ ì‚­ì œ ì‹¤íŒ¨:', error);
      alert('íŒŒì¼ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    }

    setDeleteDialog({ isOpen: false, docId: '', docName: '', type: 'writingStyle' });
  };

  // ì‚­ì œ ë‹¤ì´ì–¼ë¡œê·¸ ë‹«ê¸°
  const cancelDelete = () => {
    setDeleteDialog({ isOpen: false, docId: '', docName: '', type: 'writingStyle' });
  };

  // ìë™ ì €ì¥ í•¨ìˆ˜ (ì•Œë¦¼ ì—†ì´)
  const saveDocumentAuto = async (type: 'writingStyle' | 'seoGuide', name: string, content: string): Promise<SavedDocument> => {
    // íŒŒì¼ì„ ì‹¤ì œ í´ë”ì— ì €ì¥
    const filePath = await window.electronAPI.saveDocument(type, name, content);
    
    const newDocument: SavedDocument = {
      id: Date.now().toString(),
      name: name.trim(),  // ì›ë˜ íŒŒì¼ëª… ìœ ì§€
      content,
      filePath,
      createdAt: new Date().toISOString()
    };

    if (type === 'writingStyle') {
      // ê°™ì€ ì´ë¦„ì´ ìˆìœ¼ë©´ êµì²´, ì—†ìœ¼ë©´ ì¶”ê°€
      const existingIndex = savedWritingStyles.findIndex(doc => doc.name === name.trim());
      let updated;
      if (existingIndex >= 0) {
        // ê¸°ì¡´ íŒŒì¼ ì‚­ì œ
        await window.electronAPI.deleteDocument(savedWritingStyles[existingIndex].filePath);
        updated = [...savedWritingStyles];
        updated[existingIndex] = newDocument;
      } else {
        updated = [...savedWritingStyles, newDocument];
      }
      setSavedWritingStyles(updated);
      localStorage.setItem('savedWritingStyles', JSON.stringify(updated));
    } else {
      // ê°™ì€ ì´ë¦„ì´ ìˆìœ¼ë©´ êµì²´, ì—†ìœ¼ë©´ ì¶”ê°€
      const existingIndex = savedSeoGuides.findIndex(doc => doc.name === name.trim());
      let updated;
      if (existingIndex >= 0) {
        // ê¸°ì¡´ íŒŒì¼ ì‚­ì œ
        await window.electronAPI.deleteDocument(savedSeoGuides[existingIndex].filePath);
        updated = [...savedSeoGuides];
        updated[existingIndex] = newDocument;
      } else {
        updated = [...savedSeoGuides, newDocument];
      }
      setSavedSeoGuides(updated);
      localStorage.setItem('savedSeoGuides', JSON.stringify(updated));
    }
    
    return newDocument;
  };

  const handleFileUpload = (type: 'writingStyle' | 'seoGuide', file: File) => {
    const reader = new FileReader();
    reader.onload = async (e) => {
      const content = e.target?.result as string;
      const fileName = file.name.replace(/\.(txt|md)$/, '');
      
      try {
        // ìë™ ì €ì¥
        const savedDoc = await saveDocumentAuto(type, fileName, content);
        
        // ì €ì¥ í›„ ìë™ ì„ íƒ
        if (type === 'writingStyle') {
          if (selectedWritingStyles.length < 2) {
            setSelectedWritingStyles([...selectedWritingStyles, savedDoc]);
          }
        } else {
          setSelectedSeoGuide(savedDoc);
        }
      } catch (error) {
        console.error('íŒŒì¼ ì €ì¥ ì‹¤íŒ¨:', error);
        alert('íŒŒì¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    };
    reader.readAsText(file);
  };

  // í˜„ì¬ ì ìš©ëœ ê¸€ì“°ê¸° API ì„¤ì • ê°€ì ¸ì˜¤ê¸°
  const getWritingAPISettings = async () => {
    try {
      const llmSettings = await window.electronAPI?.getLLMSettings?.();
      if (llmSettings?.appliedSettings?.writing) {
        const { provider, model, apiKey } = llmSettings.appliedSettings.writing;
        if (provider && model && apiKey) {
          return { provider, model, apiKey };
        }
      }
      return null;
    } catch (error) {
      console.error('ê¸€ì“°ê¸° API ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
      return null;
    }
  };

  // v2 ìŠ¤íƒ€ì¼ ì œëª© ì¶”ì²œ í•¨ìˆ˜ (ì‹¤ì œ ê¸€ì“°ê¸° API ì—°ë™)
  const generateTitleRecommendations = async () => {
    if (!mainKeyword.trim()) {
      alert('ë©”ì¸í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      return;
    }

    // API ì„¤ì • í™•ì¸
    const apiSettings = await getWritingAPISettings();
    if (!apiSettings) {
      alert('ê¸€ì“°ê¸° APIê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. API ì„¤ì •ì—ì„œ ê¸€ì“°ê¸° AIë¥¼ ì—°ê²°í•´ì£¼ì„¸ìš”.');
      return;
    }

    setIsGeneratingTitles(true);
    setGeneratedTitles([]);
    setSelectedTitle('');
    
    try {
      // JSON í˜•ì‹ìœ¼ë¡œ ì œëª©ë§Œ ìš”ì²­í•˜ëŠ” ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
      const systemPrompt = `ë„¤ì´ë²„ ë¸”ë¡œê·¸ ìƒìœ„ ë…¸ì¶œì— ìœ ë¦¬í•œ 'ì •ë³´í˜•' ìŠ¤íƒ€ì¼ì˜ ì œëª© 10ê°œë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.

**ì •ë³´í˜• íŠ¹ì§•**:
- ìœ ìš©í•œ ì •ë³´ì™€ ì§€ì‹ì„ ì œê³µí•˜ëŠ” ë‚´ìš©
- ë…ìì˜ ë¬¸ì œ í•´ê²°ì— ë„ì›€ì´ ë˜ëŠ” ì‹¤ìš©ì  ì •ë³´
- íŒ, ë°©ë²•, ë…¸í•˜ìš° ë“±ì˜ ì‹¤ì§ˆì  ê°€ì¹˜ ì œê³µ

**ì œëª© ìƒì„± ê·œì¹™**:
1. ë©”ì¸í‚¤ì›Œë“œë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ í¬í•¨ (í•„ìˆ˜)
2. ë³´ì¡°í‚¤ì›Œë“œê°€ ìˆë‹¤ë©´ 1-2ê°œë¥¼ ì œëª©ì— í™œìš© (ì„ íƒì‚¬í•­)
3. í´ë¦­ ìœ ë„ì™€ ê¶ê¸ˆì¦ ìê·¹í•˜ëŠ” í‘œí˜„ ì‚¬ìš©
4. 30-60ì ë‚´ì™¸ ê¶Œì¥ (ë„ˆë¬´ ê¸¸ë©´ ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ì˜ë¦¼)
5. ë„¤ì´ë²„ ë¸”ë¡œê·¸ SEO ìµœì í™”
6. ì£¼ì œì— ë§ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ í‘œí˜„ ì‚¬ìš©
7. ì´ëª¨í‹°ì½˜ ì‚¬ìš© ê¸ˆì§€ (í…ìŠ¤íŠ¸ë§Œ ì‚¬ìš©)
8. êµ¬ì²´ì  ë…„ë„ í‘œê¸° ê¸ˆì§€ ("ìµœì‹ ", "í˜„ì¬" ë“±ìœ¼ë¡œ ëŒ€ì²´)

**ì¶œë ¥ í˜•ì‹**:
ë°˜ë“œì‹œ JSON í˜•íƒœë¡œ ì œëª© 10ê°œë§Œ ë°˜í™˜í•´ì£¼ì„¸ìš”:

{
  "titles": [
    "ì œëª©1",
    "ì œëª©2", 
    "ì œëª©3",
    "ì œëª©4",
    "ì œëª©5",
    "ì œëª©6",
    "ì œëª©7",
    "ì œëª©8",
    "ì œëª©9",
    "ì œëª©10"
  ]
}

ê° ì œëª©ì€ ì •ë³´í˜•ì˜ íŠ¹ì„±ì„ ì‚´ë¦¬ë˜, ì„œë¡œ ë‹¤ë¥¸ ì ‘ê·¼ ë°©ì‹ìœ¼ë¡œ ë‹¤ì–‘í•˜ê²Œ ìƒì„±í•´ì£¼ì„¸ìš”.`;

      // v2 ìŠ¤íƒ€ì¼ ìœ ì € í”„ë¡¬í”„íŠ¸
      const subKeywordList = subKeywords.split(',').map(k => k.trim()).filter(k => k);
      let userPrompt = "";
      
      // 1. ë¸”ë¡œê·¸ ë‚´ìš© (AI ì—­í•  ì„¤ì •)
      if (blogContent.trim()) {
        userPrompt += `# AI ì—­í•  ì„¤ì •\n${blogContent.trim()}\n\n`;
      }
      
      // 2. ë©”ì¸í‚¤ì›Œë“œ (í•„ìˆ˜)
      userPrompt += `**ë©”ì¸í‚¤ì›Œë“œ**: ${mainKeyword}`;
      
      // 3. ë³´ì¡°í‚¤ì›Œë“œ (ìˆëŠ” ê²½ìš°)
      if (subKeywordList.length > 0) {
        userPrompt += `\n**ë³´ì¡°í‚¤ì›Œë“œ**: ${subKeywordList.join(', ')}`;
      }
      
      // 4. ì œëª© ìƒì„± ê°€ì´ë“œ (ë³´ì¡°í‚¤ì›Œë“œì™€ ê¸€ ì£¼ì œ ìœ ë¬´ì— ë”°ë¼ ì¡°ê±´ë¶€)
      userPrompt += `\n\n**ì œëª© ìƒì„± ê°€ì´ë“œ**:`;
      
      if (subKeywordList.length > 0) {
        userPrompt += `\n- ë³´ì¡°í‚¤ì›Œë“œ ì¤‘ 1-2ê°œì”© í™œìš©í•˜ì—¬ ë‹¤ì–‘í•œ ì œëª© ìƒì„± (ì„ íƒì‚¬í•­)`;
      }
      
      userPrompt += `\n- ë©”ì¸í‚¤ì›Œë“œë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ë‹¤ì–‘í•œ ê´€ì ì—ì„œ ì œëª© ìƒì„±
- ë‹¤ì–‘í•œ ìŠ¤íƒ€ì¼ë¡œ ìƒì„±: ë°©ë²• ì•ˆë‚´í˜•, í›„ê¸°í˜•, ì¶”ì²œí˜•, ë¹„êµí˜•, ë¬¸ì œí•´ê²°í˜• ë“±`;
      
      if (blogContent.trim()) {
        userPrompt += `\n- ìœ„ ë¸”ë¡œê·¸ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ë…ìê°€ ê¶ê¸ˆí•´í•  ë§Œí•œ ê´€ì ì—ì„œ ì œëª© ìƒì„±`;
      } else {
        userPrompt += `\n- ë…ìê°€ ê¶ê¸ˆí•´í•  ë§Œí•œ ì‹¤ìš©ì ì¸ ê´€ì ì—ì„œ ì œëª© ìƒì„±`;
      }

      // ì „ì²´ í”„ë¡¬í”„íŠ¸ ì¡°í•©
      const fullPrompt = systemPrompt + '\n\n' + userPrompt;

      // ì—°ê²°ëœ ê¸€ì“°ê¸° APIë¥¼ í†µí•´ ì œëª© ìƒì„±
      const response = await window.electronAPI.generateTitles({
        systemPrompt: systemPrompt,
        userPrompt: userPrompt
      });
      
      // API ì‘ë‹µì—ì„œ ì œëª© ì¶”ì¶œ
      let titles: string[] = [];
      
      if (response.success) {
        // titles ë°°ì—´ì´ ì§ì ‘ ìˆëŠ” ê²½ìš° ì‚¬ìš©
        if (response.titles && Array.isArray(response.titles)) {
          titles = response.titles.slice(0, 10);
        }
        // content ì†ì„±ì—ì„œ íŒŒì‹±ì´ í•„ìš”í•œ ê²½ìš° (main processì—ì„œ contentë¡œ ë°˜í™˜)
        else if ((response as any).content) {
          const content = (response as any).content;
          try {
            // JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µì´ ì˜¬ ê²½ìš° íŒŒì‹±
            const jsonMatch = content.match(/\{[\s\S]*\}/);
            if (jsonMatch) {
              const jsonData = JSON.parse(jsonMatch[0]);
              if (jsonData.titles && Array.isArray(jsonData.titles)) {
                titles = jsonData.titles.slice(0, 10);
              }
            }
          } catch (error) {
            console.warn('JSON íŒŒì‹± ì‹¤íŒ¨, ë²ˆí˜¸ ëª©ë¡ìœ¼ë¡œ ì²˜ë¦¬:', error);
          }

          // fallback: ë²ˆí˜¸ ëª©ë¡ í˜•íƒœ ì²˜ë¦¬
          if (titles.length === 0) {
            const titleMatches = content.match(/^\d+\.\s*(.+)$/gm);
            if (titleMatches && titleMatches.length > 0) {
              titles = titleMatches
                .map((match: string): string => match.replace(/^\d+\.\s*/, '').trim())
                .slice(0, 10);
            }
          }
        }
      } else {
        throw new Error(response.error || 'ì œëª© ìƒì„± API í˜¸ì¶œ ì‹¤íŒ¨');
      }
      
      if (titles.length > 0) {
        setGeneratedTitles(titles);
      } else {
        alert('ì œëª© ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
      
    } catch (error) {
      console.error('ì œëª© ìƒì„± ì‹¤íŒ¨:', error);
      alert('ì œëª© ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + (error as Error).message);
    } finally {
      setIsGeneratingTitles(false);
    }
  };

  // ìë™ ìƒì„± í•¨ìˆ˜ (ì œëª© ì„ íƒ í›„ í˜¸ì¶œë¨)
  const handleStartGeneration = async () => {
    // í•„ìˆ˜ ìš”êµ¬ì‚¬í•­ ê²€ì¦
    if (!selectedTitle) {
      alert('ì œëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
      return;
    }

    if (!mainKeyword.trim()) {
      alert('ë©”ì¸í‚¤ì›Œë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      return;
    }

    if (!selectedSeoGuide) {
      alert('SEO ê°€ì´ë“œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
      return;
    }

    setIsGenerating(true);
    setGenerationStep('í´ë¡œë“œ ì›¹ ë¸Œë¼ìš°ì € ì—´ê¸°...');
    
    try {
      await window.electronAPI.openClaudeWeb();
      setGenerationStep('ë¬¸ì„œ ì—…ë¡œë“œ ì¤‘...');
      
      // ë³´ì¡°í‚¤ì›Œë“œ ë¦¬ìŠ¤íŠ¸ ìƒì„±
      const subKeywordList = subKeywords.split(',').map(k => k.trim()).filter(k => k);
      
      // ìƒì„¸í•œ ê¸€ì“°ê¸° ì§€ì‹œì‚¬í•­ ìƒì„±
      let detailedInstructions = `# ë¸”ë¡œê·¸ ê¸€ ì‘ì„± ìš”ì²­

## ğŸ¯ ì‘ì„±í•  ì œëª© (ë³€ê²½ ê¸ˆì§€)
"${selectedTitle}"

## ğŸ“ ì‘ì„± ì§€ì¹¨

### í•µì‹¬ ì •ë³´
- **ë©”ì¸í‚¤ì›Œë“œ**: ${mainKeyword}
- **ë³´ì¡°í‚¤ì›Œë“œ**: ${subKeywordList.length > 0 ? subKeywordList.join(', ') : 'ì—†ìŒ'}`;

      if (blogContent.trim()) {
        detailedInstructions += `
- **ê¸€ ë‚´ìš© ë°©í–¥ì„±**: ${blogContent.trim()}

### ë‚´ìš© ìš”êµ¬ì‚¬í•­
- ìœ„ì— ì œì‹œëœ "${selectedTitle}" ì œëª©ì— ì •í™•íˆ ë§ëŠ” ë‚´ìš©ìœ¼ë¡œ ì‘ì„±
- "${blogContent.trim()}" ì´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ë…ìì—ê²Œ ìœ ìš©í•œ ì •ë³´ ì œê³µ`;
      }

      detailedInstructions += `

### SEO ìµœì í™” ìš”êµ¬ì‚¬í•­
- **ë©”ì¸í‚¤ì›Œë“œ "${mainKeyword}"**: ë³¸ë¬¸ì— 5-6íšŒ ìì—°ìŠ¤ëŸ½ê²Œ ë°˜ë³µ (ì œëª© í¬í•¨í•˜ì—¬ ì´ 6-7íšŒ)`;

      if (subKeywordList.length > 0) {
        detailedInstructions += `
- **ë³´ì¡°í‚¤ì›Œë“œë“¤**: ${subKeywordList.map(keyword => `"${keyword}"`).join(', ')} ê°ê° 3-4íšŒì”© ìì—°ìŠ¤ëŸ½ê²Œ ì‚¬ìš©`;
      }

      detailedInstructions += `
- í‚¤ì›Œë“œëŠ” ì–µì§€ë¡œ ë„£ì§€ ë§ê³  ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ë§¥ì—ì„œ ì‚¬ìš©
- ë…ìê°€ ì½ê¸°ì— ì–´ìƒ‰í•˜ì§€ ì•Šë„ë¡ ìì—°ìŠ¤ëŸ½ê²Œ ë°°ì¹˜

### ê¸€ ì‘ì„± ìŠ¤íƒ€ì¼
- ì„ íƒëœ ì œëª© "${selectedTitle}"ì˜ ì˜ë„ì™€ ì™„ì „íˆ ì¼ì¹˜í•˜ëŠ” ë‚´ìš©
- ë…ìì˜ ê¶ê¸ˆì¦ì„ í•´ê²°í•˜ëŠ” ì‹¤ìš©ì ì¸ ì •ë³´ ì œê³µ
- ìì—°ìŠ¤ëŸ½ê³  ì½ê¸° ì‰¬ìš´ ë¬¸ì²´
- êµ¬ì²´ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ë‚´ìš© í¬í•¨

### ì¤‘ìš” ì‚¬í•­
âš ï¸ **ì œëª© "${selectedTitle}"ì„ ì ˆëŒ€ ë³€ê²½í•˜ì§€ ë§ˆì„¸ìš”**
âš ï¸ **ë©”ì¸í‚¤ì›Œë“œì™€ ë³´ì¡°í‚¤ì›Œë“œë¥¼ ì§€ì •ëœ íšŸìˆ˜ë§Œí¼ ìì—°ìŠ¤ëŸ½ê²Œ í¬í•¨í•˜ì„¸ìš”**
âš ï¸ **ê¸€ì˜ ëª¨ë“  ë‚´ìš©ì´ ì„ íƒëœ ì œëª©ê³¼ ì¼ì¹˜í•˜ë„ë¡ ì‘ì„±í•˜ì„¸ìš”**`;

      await window.electronAPI.sendToClaudeWeb(
        selectedWritingStyles.map(doc => doc.filePath),
        selectedSeoGuide?.filePath || '',
        detailedInstructions
      );
      setGenerationStep('AI ì‘ë‹µ ìƒì„± ì¤‘...');
      
      await window.electronAPI.waitForClaudeResponse();
      setGenerationStep('ë§ˆí¬ë‹¤ìš´ ë‹¤ìš´ë¡œë“œ ì¤‘...');
      
      const content = await window.electronAPI.downloadFromClaude();
      setGenerationStep('ì™„ë£Œ!');
      
      setTimeout(() => {
        onComplete({ 
          writingStylePaths: selectedWritingStyles.map(doc => doc.filePath),
          seoGuidePath: selectedSeoGuide?.filePath || '',
          topic: `ì œëª©: ${selectedTitle}`,
          generatedContent: content
        });
      }, 1000);
      
    } catch (error) {
      console.error('ìƒì„± ì‹¤íŒ¨:', error);
      setGenerationStep('ì˜¤ë¥˜ ë°œìƒ: ' + (error as Error).message);
      setIsGenerating(false);
    }
  };

  return (
    <div style={{
      maxWidth: '1200px',
      margin: '0 auto',
      padding: '20px',
      backgroundColor: '#ffffff',
      minHeight: '100vh'
    }}>
      {/* ë‹¨ê³„ ì œëª© ì œê±° */}
      
      {/* ë¬¸ì„œ ì—…ë¡œë“œ í†µí•© ì„¹ì…˜ */}
      <div style={{
        backgroundColor: '#f8f9fa',
        border: '2px solid #e9ecef',
        borderRadius: '16px',
        padding: '25px',
        marginBottom: '40px'
      }}>
        <div style={{ textAlign: 'center', marginBottom: '30px' }}>
          <h3 style={{ color: '#495057', fontSize: '20px', marginBottom: '8px' }}>ğŸ“š ë¬¸ì„œ ì—…ë¡œë“œ</h3>
          <p style={{ color: '#6c757d', fontSize: '14px', margin: 0 }}>
            ë¸”ë¡œê·¸ ê¸€ ìƒì„±ì— ì‚¬ìš©í•  ì°¸ê³  ë¬¸ì„œë“¤ì„ ì—…ë¡œë“œí•˜ì„¸ìš”
          </p>
        </div>
        
        <div style={{ display: 'flex', gap: '25px' }}>
          {/* ë§íˆ¬ ë¬¸ì„œ */}
          <div style={{ flex: '1' }}>
            <div style={{
              backgroundColor: '#fff',
              border: '1px solid #dee2e6',
              borderRadius: '12px',
              padding: '20px'
            }}>
              <h4 style={{ color: '#495057', marginBottom: '8px', fontSize: '16px' }}>âœï¸ ë‚˜ë§Œì˜ ë§íˆ¬ ë¬¸ì„œ</h4>
              <p style={{ color: '#6c757d', fontSize: '13px', marginBottom: '16px' }}>
                í‰ì†Œ ë¸”ë¡œê·¸ ê¸€ ìŠ¤íƒ€ì¼ ì°¸ê³ ìš© (ìµœëŒ€ 2ê°œ)
              </p>
            
              <input
                type="file"
                accept=".txt,.md"
                onChange={(e) => {
                  const file = e.target.files?.[0];
                  if (file) handleFileUpload('writingStyle', file);
                }}
                style={{
                  padding: '8px',
                  border: '2px dashed #dee2e6',
                  borderRadius: '8px',
                  backgroundColor: '#fafafa',
                  width: '100%',
                  cursor: 'pointer',
                  fontSize: '13px'
                }}
              />

              {savedWritingStyles.length > 0 && (
                <div style={{ marginTop: '12px' }}>
                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>
                    {savedWritingStyles.map(doc => {
                      const isSelected = selectedWritingStyles.some(selected => selected.id === doc.id);
                      return (
                        <div key={doc.id} style={{
                          display: 'flex',
                          alignItems: 'center',
                          backgroundColor: isSelected ? '#e8f5e8' : '#f8f9fa',
                          border: isSelected ? '2px solid #28a745' : '1px solid #dee2e6',
                          borderRadius: '15px',
                          padding: '4px 10px',
                          fontSize: '12px'
                        }}>
                          <span
                            onClick={() => toggleWritingStyle(doc)}
                            style={{ cursor: 'pointer', color: '#495057', marginRight: '6px' }}
                          >
                            {isSelected ? 'âœ… ' : ''}{doc.name}
                          </span>
                          <button
                            onClick={() => openDeleteDialog('writingStyle', doc.id, doc.name)}
                            style={{
                              background: 'none', border: 'none', color: '#dc3545',
                              cursor: 'pointer', fontSize: '12px', padding: '0'
                            }}
                          >
                            Ã—
                          </button>
                        </div>
                      );
                    })}
                  </div>
                  {selectedWritingStyles.length > 0 && (
                    <div style={{ marginTop: '8px', fontSize: '11px', color: '#6c757d' }}>
                      ì„ íƒ: {selectedWritingStyles.length}/2
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>

          {/* SEO ê°€ì´ë“œ */}
          <div style={{ flex: '1' }}>
            <div style={{
              backgroundColor: '#fff',
              border: '1px solid #dee2e6',
              borderRadius: '12px',
              padding: '20px'
            }}>
              <h4 style={{ color: '#495057', marginBottom: '8px', fontSize: '16px' }}>ğŸ“Š ë„¤ì´ë²„ SEO ê°€ì´ë“œ</h4>
              <p style={{ color: '#6c757d', fontSize: '13px', marginBottom: '16px' }}>
                SEO ìµœì í™” ê°€ì´ë“œ (1ê°œ ì„ íƒ)
              </p>
            
              <input
                type="file"
                accept=".txt,.md"
                onChange={(e) => {
                  const file = e.target.files?.[0];
                  if (file) handleFileUpload('seoGuide', file);
                }}
                style={{
                  padding: '8px',
                  border: '2px dashed #dee2e6',
                  borderRadius: '8px',
                  backgroundColor: '#fafafa',
                  width: '100%',
                  cursor: 'pointer',
                  fontSize: '13px'
                }}
              />

              {savedSeoGuides.length > 0 && (
                <div style={{ marginTop: '12px' }}>
                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>
                    {savedSeoGuides.map(doc => {
                      const isSelected = selectedSeoGuide?.id === doc.id;
                      return (
                        <div key={doc.id} style={{
                          display: 'flex',
                          alignItems: 'center',
                          backgroundColor: isSelected ? '#e3f2fd' : '#f8f9fa',
                          border: isSelected ? '2px solid #2196f3' : '1px solid #dee2e6',
                          borderRadius: '15px',
                          padding: '4px 10px',
                          fontSize: '12px'
                        }}>
                          <span
                            onClick={() => toggleSeoGuide(doc)}
                            style={{ cursor: 'pointer', color: '#495057', marginRight: '6px' }}
                          >
                            {isSelected ? 'ğŸ“˜ ' : 'ğŸ“„ '}{doc.name}
                          </span>
                          <button
                            onClick={() => openDeleteDialog('seoGuide', doc.id, doc.name)}
                            style={{
                              background: 'none', border: 'none', color: '#dc3545',
                              cursor: 'pointer', fontSize: '12px', padding: '0'
                            }}
                          >
                            Ã—
                          </button>
                        </div>
                      );
                    })}
                  </div>
                  {selectedSeoGuide && (
                    <div style={{ marginTop: '8px', fontSize: '11px', color: '#6c757d' }}>
                      ì„ íƒ: {selectedSeoGuide.name}
                    </div>
                  )}
                </div>
              )}
            </div>
          </div>
        </div>
      </div>

      {/* í‚¤ì›Œë“œ ì…ë ¥ ë° ì œëª© ì¶”ì²œ í†µí•© */}
      <div style={{
        backgroundColor: '#fff',
        border: '2px solid #e9ecef',
        borderRadius: '16px',
        padding: '25px',
        marginBottom: '20px'
      }}>
        <h3 style={{ color: '#495057', marginBottom: '8px', fontSize: '20px' }}>ğŸ” í‚¤ì›Œë“œ ì…ë ¥ ë° ì œëª© ì¶”ì²œ</h3>
        <p style={{ color: '#6c757d', fontSize: '14px', marginBottom: '20px' }}>
          ë©”ì¸í‚¤ì›Œë“œ, SEO ë³´ì¡°í‚¤ì›Œë“œ, ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ë©´ AIê°€ ë…ì ê´€ì‹¬ì„ ëŒ ë§¤ë ¥ì ì¸ ì œëª© 10ê°œë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤
        </p>
        
        {/* í†µí•© ì…ë ¥ ì„¹ì…˜ - 3ê°œ í•„ë“œ */}
        <div style={{ display: 'grid', gap: '20px', marginBottom: '25px' }}>
          {/* ë©”ì¸í‚¤ì›Œë“œ */}
          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 'bold', color: '#495057' }}>
              ë©”ì¸í‚¤ì›Œë“œ *
            </label>
            <input
              type="text"
              value={mainKeyword}
              onChange={(e) => setMainKeyword(e.target.value)}
              placeholder="ì˜ˆ: í™ˆíŠ¸ë ˆì´ë‹"
              style={{
                width: '100%',
                border: '2px solid #dee2e6',
                borderRadius: '8px',
                padding: '12px',
                fontSize: '14px',
                backgroundColor: '#fafafa'
              }}
            />
            <small style={{ color: '#6c757d', fontSize: '12px' }}>
              ë¸”ë¡œê·¸ ê¸€ì˜ í•µì‹¬ ì£¼ì œ í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”
            </small>
          </div>
          
          {/* ë³´ì¡°í‚¤ì›Œë“œ */}
          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 'bold', color: '#495057' }}>
              ë³´ì¡°í‚¤ì›Œë“œ
            </label>
            <input
              type="text"
              value={subKeywords}
              onChange={(e) => setSubKeywords(e.target.value)}
              placeholder="ì˜ˆ: í™ˆíŠ¸ë ˆì´ë‹ë£¨í‹´, í™ˆíŠ¸ë ˆì´ë‹ì¥ë¹„, ì§‘ì—ì„œìš´ë™ (ì‰¼í‘œë¡œ êµ¬ë¶„)"
              style={{
                width: '100%',
                border: '2px solid #dee2e6',
                borderRadius: '8px',
                padding: '12px',
                fontSize: '14px',
                backgroundColor: '#fafafa'
              }}
            />
            <small style={{ color: '#6c757d', fontSize: '12px' }}>
              ê´€ë ¨ í‚¤ì›Œë“œë¥¼ ì‰¼í‘œ(,)ë¡œ êµ¬ë¶„í•´ì„œ ì…ë ¥í•˜ì„¸ìš”
            </small>
          </div>

          {/* ì–´ë–¤ ë¸”ë¡œê·¸ë¥¼ ì“°ê³  ì‹¶ì€ì§€ */}
          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 'bold', color: '#495057' }}>
              ì“°ê³  ì‹¶ì€ ê¸€ ì£¼ì œ
            </label>
            <textarea
              value={blogContent}
              onChange={(e) => setBlogContent(e.target.value)}
              placeholder="ì˜ˆ: ì´ˆë³´ìë„ ì‰½ê²Œ ë”°ë¼í•  ìˆ˜ ìˆëŠ” í™ˆíŠ¸ë ˆì´ë‹ ìš´ë™ë²•ê³¼ íš¨ê³¼ì ì¸ ë£¨í‹´ êµ¬ì„± ë°©ë²•, í•„ìˆ˜ ì¥ë¹„ ì¶”ì²œ"
              rows={3}
              style={{
                width: '100%',
                border: '2px solid #dee2e6',
                borderRadius: '8px',
                padding: '12px',
                fontSize: '14px',
                backgroundColor: '#fafafa',
                resize: 'vertical',
                fontFamily: 'inherit'
              }}
            />
            <small style={{ color: '#6c757d', fontSize: '12px' }}>
              ì–´ë–¤ ë‚´ìš©ìœ¼ë¡œ ë¸”ë¡œê·¸ ê¸€ì„ ì“¸ì§€ ìì„¸íˆ ì ì–´ì£¼ì„¸ìš”
            </small>
          </div>
        </div>

        {/* AI ì¶”ì²œ ì œëª© ì„¹ì…˜ (í•­ìƒ í‘œì‹œ) */}
        <div style={{
          backgroundColor: '#f8f9fa',
          border: '1px solid #dee2e6',
          borderRadius: '10px',
          padding: '20px',
          marginBottom: '20px'
        }}>
          <div style={{ 
            display: 'flex', 
            alignItems: 'center', 
            justifyContent: 'space-between',
            marginBottom: '15px'
          }}>
            <h4 style={{ color: '#495057', margin: 0, fontSize: '16px' }}>
              ğŸ¯ AI ì¶”ì²œ ì œëª© 
              {generatedTitles.length > 0 && <span style={{ color: '#28a745', fontWeight: 'normal' }}>({generatedTitles.length}ê°œ ìƒì„±ë¨)</span>}
            </h4>
            
            {/* ì œëª© ìƒì„± ë²„íŠ¼ - ì˜¤ë¥¸ìª½ ë°°ì¹˜ */}
            <button
              onClick={generateTitleRecommendations}
              disabled={isGeneratingTitles || !mainKeyword.trim()}
              style={{
                backgroundColor: isGeneratingTitles ? '#6c757d' : (generatedTitles.length > 0 ? '#28a745' : '#007bff'),
                color: '#fff',
                border: 'none',
                borderRadius: '8px',
                padding: '10px 18px',
                fontSize: '13px',
                fontWeight: 'bold',
                cursor: isGeneratingTitles ? 'not-allowed' : 'pointer',
                display: 'flex',
                alignItems: 'center',
                gap: '6px',
                opacity: !mainKeyword.trim() ? 0.5 : 1,
                transition: 'all 0.3s ease',
                minWidth: '140px',
                justifyContent: 'center'
              }}
            >
              {isGeneratingTitles ? (
                <>
                  <div style={{
                    width: '14px',
                    height: '14px',
                    border: '2px solid #fff',
                    borderTop: '2px solid transparent',
                    borderRadius: '50%',
                    animation: 'spin 1s linear infinite'
                  }}></div>
                  ìƒì„± ì¤‘...
                </>
              ) : generatedTitles.length > 0 ? (
                <>
                  ğŸ”„ ì¬ìƒì„±
                </>
              ) : (
                <>
                  âœ¨ ì œëª© ìƒì„±
                </>
              )}
            </button>
          </div>
          
          {/* ì œëª©ì´ ìƒì„±ë˜ê¸° ì „ ì•ˆë‚´ ë©”ì‹œì§€ */}
          {generatedTitles.length === 0 && !isGeneratingTitles && (
            <div style={{
              textAlign: 'center',
              padding: '30px',
              color: '#6c757d',
              fontSize: '14px',
              backgroundColor: '#fff',
              border: '2px dashed #dee2e6',
              borderRadius: '8px'
            }}>
              ğŸ“ ë©”ì¸í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ê³  "ì œëª© ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•´ì£¼ì„¸ìš”
            </div>
          )}
          
          {/* ì œëª© ìƒì„± ì¤‘ í‘œì‹œ */}
          {isGeneratingTitles && (
            <div style={{
              textAlign: 'center',
              padding: '30px',
              color: '#007bff',
              fontSize: '14px',
              backgroundColor: '#fff',
              border: '2px solid #007bff',
              borderRadius: '8px'
            }}>
              <div style={{
                width: '24px',
                height: '24px',
                border: '3px solid #007bff',
                borderTop: '3px solid transparent',
                borderRadius: '50%',
                margin: '0 auto 12px auto',
                animation: 'spin 1s linear infinite'
              }}></div>
              AIê°€ ë§¤ë ¥ì ì¸ ì œëª© 10ê°œë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...
            </div>
          )}
          
          {/* ì œëª© ì„ íƒ ë“œë¡­ë‹¤ìš´ */}
          {generatedTitles.length > 0 && !isGeneratingTitles && (
            <>
              <div style={{ marginBottom: '20px' }}>
                <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 'bold', color: '#495057' }}>
                  ì‚¬ìš©í•  ì œëª© ì„ íƒ *
                </label>
                <select
                  value={selectedTitle}
                  onChange={(e) => setSelectedTitle(e.target.value)}
                  style={{
                    width: '100%',
                    border: '2px solid #dee2e6',
                    borderRadius: '8px',
                    padding: '12px',
                    fontSize: '14px',
                    backgroundColor: '#fff',
                    cursor: 'pointer'
                  }}
                >
                  <option value="">ì œëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”...</option>
                  {generatedTitles.map((title, index) => (
                    <option key={index} value={title}>
                      {index + 1}. {title}
                    </option>
                  ))}
                </select>
              </div>
              
              {/* ì„ íƒëœ ì œëª© í‘œì‹œ */}
              {selectedTitle && (
                <div style={{
                  marginBottom: '20px',
                  padding: '12px',
                  backgroundColor: '#e8f5e8',
                  border: '1px solid #c3e6cb',
                  borderRadius: '6px'
                }}>
                  <div style={{ fontSize: '12px', color: '#155724', fontWeight: 'bold', marginBottom: '4px' }}>
                    âœ… ì„ íƒëœ ì œëª©
                  </div>
                  <div style={{ fontSize: '14px', color: '#155724', fontWeight: 'bold' }}>
                    {selectedTitle}
                  </div>
                </div>
              )}
              
              {/* ê¸€ ìƒì„± ë²„íŠ¼ */}
              {selectedTitle && (
                <div style={{ textAlign: 'center' }}>
                  <button
                    onClick={handleStartGeneration}
                    disabled={isGenerating}
                    style={{
                      backgroundColor: isGenerating ? '#6c757d' : '#28a745',
                      color: '#fff',
                      border: 'none',
                      borderRadius: '10px',
                      padding: '14px 28px',
                      fontSize: '16px',
                      fontWeight: 'bold',
                      cursor: isGenerating ? 'not-allowed' : 'pointer',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px',
                      margin: '0 auto',
                      transition: 'all 0.3s ease'
                    }}
                    onMouseEnter={(e) => {
                      if (!isGenerating) {
                        e.currentTarget.style.backgroundColor = '#218838';
                        e.currentTarget.style.transform = 'translateY(-2px)';
                      }
                    }}
                    onMouseLeave={(e) => {
                      if (!isGenerating) {
                        e.currentTarget.style.backgroundColor = '#28a745';
                        e.currentTarget.style.transform = 'translateY(0)';
                      }
                    }}
                  >
                    {isGenerating ? (
                      <>
                        <div style={{
                          width: '16px',
                          height: '16px',
                          border: '2px solid #fff',
                          borderTop: '2px solid transparent',
                          borderRadius: '50%',
                          animation: 'spin 1s linear infinite'
                        }}></div>
                        ê¸€ ìƒì„± ì¤‘...
                      </>
                    ) : (
                      <>
                        ğŸš€ ì„ íƒí•œ ì œëª©ìœ¼ë¡œ ê¸€ ìƒì„±í•˜ê¸°
                      </>
                    )}
                  </button>
                </div>
              )}
            </>
          )}
        </div>

        {/* ìˆ˜ë™ ì—…ë¡œë“œ ë²„íŠ¼ - ì œëª© ì„ íƒ í›„ì—ë§Œ í‘œì‹œ */}
        {selectedTitle && (
          <div style={{ textAlign: 'center', marginTop: '20px' }}>
            <div style={{ 
              marginBottom: '12px', 
              fontSize: '12px', 
              color: '#6c757d',
              fontStyle: 'italic'
            }}>
              ë˜ëŠ”
            </div>
            <label style={{
              backgroundColor: '#6c757d',
              color: '#fff',
              border: 'none',
              borderRadius: '12px',
              padding: '12px 24px',
              fontSize: '14px',
              fontWeight: 'bold',
              cursor: 'pointer',
              display: 'inline-flex',
              alignItems: 'center',
              gap: '8px',
              transition: 'all 0.3s ease'
            }}
            onMouseEnter={(e) => {
              const target = e.target as HTMLLabelElement;
              target.style.backgroundColor = '#5a6268';
              target.style.transform = 'translateY(-2px)';
            }}
            onMouseLeave={(e) => {
              const target = e.target as HTMLLabelElement;
              target.style.backgroundColor = '#6c757d';
              target.style.transform = 'translateY(0)';
            }}>
              ğŸ“„ ì§ì ‘ ê¸€ ì—…ë¡œë“œ
              <input
                type="file"
                accept=".md,.txt"
                style={{ display: 'none' }}
                onChange={(e) => {
                  const file = e.target.files?.[0];
                  if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                      const content = event.target?.result as string;
                      
                      // ì„ íƒëœ ì œëª©ê³¼ í‚¤ì›Œë“œ ì •ë³´ í¬í•¨
                      const finalTopic = selectedTitle ? 
                        `ì œëª©: ${selectedTitle}\në¸”ë¡œê·¸ ì„¤ëª…: ${blogContent}\në©”ì¸í‚¤ì›Œë“œ: ${mainKeyword}\në³´ì¡°í‚¤ì›Œë“œ: ${subKeywords}` : 
                        (blogContent || 'ìˆ˜ë™ ì—…ë¡œë“œëœ ê¸€');
                        
                      onComplete({ 
                        writingStylePaths: selectedWritingStyles.map(doc => doc.filePath),
                        seoGuidePath: selectedSeoGuide?.filePath || '',
                        topic: finalTopic,
                        generatedContent: content
                      });
                    };
                    reader.readAsText(file);
                  }
                }}
              />
            </label>
          </div>
        )}
      </div>

      {/* ìƒì„± ì§„í–‰ ìƒíƒœ í‘œì‹œ */}
      {isGenerating && (
        <div style={{
          backgroundColor: '#fff',
          border: '2px solid #007bff',
          borderRadius: '16px',
          padding: '25px',
          textAlign: 'center'
        }}>
          <div style={{
            width: '32px',
            height: '32px',
            border: '4px solid #007bff',
            borderTop: '4px solid transparent',
            borderRadius: '50%',
            margin: '0 auto 16px auto',
            animation: 'spin 1s linear infinite'
          }}></div>
          <p style={{ color: '#007bff', fontSize: '16px', margin: 0, fontWeight: 'bold' }}>
            {generationStep}
          </p>
          <div style={{
            marginTop: '12px',
            padding: '8px',
            backgroundColor: '#e3f2fd',
            borderRadius: '6px',
            fontSize: '12px',
            color: '#1565c0'
          }}>
            ğŸ’¡ ì„ íƒëœ ì œëª©ê³¼ í‚¤ì›Œë“œë¡œ AIê°€ ìµœì í™”ëœ ë¸”ë¡œê·¸ ê¸€ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤
          </div>
        </div>
      )}
      
      <style>
        {`
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
        `}
      </style>

      {/* ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ */}
      <ConfirmDialog
        isOpen={deleteDialog.isOpen}
        title="ë¬¸ì„œ ì‚­ì œ"
        message={`"${deleteDialog.docName}" ë¬¸ì„œë¥¼ ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`}
        onConfirm={confirmDelete}
        onCancel={cancelDelete}
      />
    </div>
  );
};

export default Step1Setup;